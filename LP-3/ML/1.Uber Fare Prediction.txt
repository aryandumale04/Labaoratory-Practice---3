#prerequisites
import pandas as pd 
import numpy as np 
import seaborn as sns
import matplotlib.pyplot as plt
from sklearn.model_selection import train_test_split
from sklearn.linear_model import LinearRegression
from sklearn.ensemble  import RandomForestRegressor
from sklearn.metrics import mean_squared_error ,r2_score
data = sns.load_dataset("car_crashes")
df = pd.DataFrame(data)
df
df=df.drop(columns=["abbrev"],axis=1)

df


#via IQR
Q1 = df["speeding"].quantile(0.25)
Q3 = df["speeding"].quantile(0.75) 
IQR =  Q3 -Q1
lower = Q1 - 1.5 * IQR
upper = Q3 + 1.5 * IQR 
outliers = df[(df["speeding"] < lower) | (df["speeding"] > upper)]
print("Outliers : ",outliers)

#removing outliers 
df=df[(df["speeding"] >= lower) & (df["speeding"] <= upper)]

 #model preparation
x = df.drop("total",axis=1)
y = df["total"]

x_train,x_test,y_train,y_test = train_test_split(x,y,test_size=0.2,random_state=42)
linearRegressionModel = LinearRegression()

#test the model 
linearRegressionModel.fit(x_train,y_train)

#make predictions
y_pred= linearRegressionModel.predict(x_test)

#evaluate the results of the model 
rmse = np.sqrt(mean_squared_error(y_test,y_pred))
r2=r2_score(y_test,y_pred)
print("RMSE SCORE OF LINEAR REGRESSION MODEL : ",rmse)
print("R2 SCORE OF LINEAR REGRESSION MODEL : ",r2)

#Random Forest 
randomForestModel  = RandomForestRegressor(n_estimators=10,random_state=42)
randomForestModel.fit(x_train,y_train)
yy_pred=randomForestModel.predict(x_test)
rmse2 = np.sqrt(mean_squared_error(y_test,yy_pred))
r22 = r2_score(y_test,yy_pred)
print("RMSE SCORE OF Random Forest Regressor Model: ",rmse2)
print("R2 SCORE OF Random Forest Regressor MODEL : ",r22)
